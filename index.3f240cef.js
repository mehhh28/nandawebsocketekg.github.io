var t=class{constructor(t,e=!1){this.view=t,this.debug=e}useState(t,e,n){const a=t;let s=e;return this.updateView(a,s,!0),[()=>s,t=>{n&&n(t,s,a),s=t,this.updateView(a,s)}]}updateView(t,e,n){this.view&&this.view.update(t,e,n)}};const e=new t(new class{constructor(t=document,e=!1){if(this.root=t,this.debug=e,e){const e=t.tagName+(""!=t.id?"#"+t.id:""),n=document.createElement("div");n.addEventListener("dragend",(t=>{t.preventDefault(),t.target.style.top=`${t.pageY}px`,t.target.style.left=`${t.pageX}px`})),n.setAttribute("class","comfey-debug"),n.setAttribute("draggable",!0),n.innerHTML=`<h2>Comfey Debug (${e})</h2>\n        <table>\n          <thead>\n            <tr>\n              <th>State</th>\n              <th>Value</th>\n            </tr>\n          </thead>\n          <tbody>\n          </tbody>`,this.root.appendChild(n)}}update(t,e,n){if(n&&this.debug){const e=document.createElement("tr");e.innerHTML=`\n              <th>${t}</th>\n              <td>\n                <span data-bind="${t}"></span>\n              </td>\n            `,this.root.querySelector(".comfey-debug tbody").appendChild(e)}const a=this.root.querySelectorAll(`[data-bind="${t}"]`);for(const t of a)t.innerHTML=e;const s=this.root.querySelectorAll(`[data-bind-visible^="${t}"]`);for(const t of s){const[,n,a]=t.dataset.bindVisible.split("::");a&&console.warn("Comfey: Comparators are not yet supported in bind-visible."),n?n===e?t.classList.add("visible"):t.classList.remove("visible"):e?t.classList.add("visible"):t.classList.remove("visible")}const o=this.root.querySelectorAll(`[data-bind-hidden="${t}"]`);for(const t of o)e?t.classList.add("hidden"):t.classList.remove("hidden");const i=this.root.querySelectorAll(`[data-bind-class^="${t}:"]`);for(const t of i){const[,n,a]=t.dataset.bindClass.split("::"),s=n;if(!s)return;e&&!a||e&&a&&e==a?t.classList.add(s):t.classList.remove(s)}const r=this.root.querySelectorAll(`[data-bind-attr^="${t}:"]`);for(const t of r){const[,n,a]=t.dataset.bindAttr.split("::");e?t.setAttribute(n,a.replaceAll("$",e)):t.removeAttribute(n)}}}(document.getElementById("ecg"),0)),[n,a]=e.useState("rr",0),[s,o]=e.useState("freq",0),[i,r]=e.useState("hr",0),[d,l]=e.useState("value",0),c=document.getElementById("pause-btn");let p=-1;const u=300,h=[],b=6,g=0,m=40,f=0,y=600-g-f,v=360-b-m,w=d3.scale.linear().domain([p-u+1,p]).range([0,y]),S=d3.svg.axis().scale(w).orient("bottom"),L=d3.scale.linear().range([v,0]).domain([0,255]),x=d3.svg.axis().scale(L).orient("left"),A=d3.svg.line().interpolate("basis").x((function(t,e){return w(t.time)})).y((function(t,e){return L(t.value)})),E=d3.select(".ecg-graph").append("p").append("svg").attr("width",y+f+g).attr("height",v+b+m).style("margin-left",f+"px").append("g").attr("transform","translate("+f+","+b+")");E.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",y).attr("height",v);const $=E.append("g").attr("class","x axis").attr("transform","translate(0,"+v+")").call(w.axis=S);E.append("g").attr("class","y axis").attr("transform","translate(60,0)").call(L.axis=x),E.append("g").attr("clip-path","url(#clip)").append("path").style("fill","none").style("stroke","black").style("stroke-width","1").data([h]).attr("class","line");if("WebSocket"in window){const t=new WebSocket("ws://esp-ecg.local/ws");t.onerror=t=>{console.error({e:t})},t.onopen=function(){c.addEventListener("click",(e=>{t.send("p")}))};let e=0,n=[],s=+new Date;t.onmessage=function(t){t.data.trim().split(" ").forEach((t=>{const i=performance.now(),d=parseInt(t);if(n.length<=100&&n.push(i-e),100===n.length){const t=n.reduce(((t,e)=>t+e),0)/100;o(Math.round(1e3/t)),n=[]}if(e=i,d>153){const t=+new Date,e=t-s;e>200&&(s=t,a(e),r(Math.round(1e3/e*60)))}h.push({time:++p,value:d}),n.length%5&&l(d/80+15),w.domain([p-u+2,p]),$.call(w.axis),E.select(".line").attr("d",A),h.length>u&&h.shift()}))},t.onclose=function(){console.warn("Connection is closed..."),setTimeout((()=>{window.location="."}),2e3)}}else console.error("WebSocket NOT supported by your Browser!");document.getElementById("new").addEventListener("click",(t=>{const e=document.createElement("textarea");document.getElementById("datag").append(e),document.getElementById("data").setAttribute("id",+new Date),e.setAttribute("id","data")}));
//# sourceMappingURL=index.3f240cef.js.map
