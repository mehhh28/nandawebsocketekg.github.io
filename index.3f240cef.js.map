{"mappings":"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","sources":["node_modules/comfey/src/comfey.js","src/client.js","node_modules/comfey/src/view/dom.js"],"sourcesContent":["/**\n * Comfey\n *\n * Lightweight framework for keeping state for your vanilla Js and simple data binding for HTML\n *\n * Comfey #764 (Japanese: キュワワー Cuwawa) is a Fairy-type Pokémon introduced in Generation VII.\n * It is not known to evolve into or from any other Pokémon.\n *\n * @author Anil Maharjan <anilmaharjan.com.np>\n **/\n\nclass Comfey {\n  /**\n   * Creates an instance of Comfey.\n   * @param {View} [view] View updater, implements IView Interface\n   * @param {boolean} [debug=false] Flag to enable debug mode\n   * @memberof Comfey\n   */\n  constructor(view, debug = false) {\n    this.view = view;\n    this.debug = debug;\n  }\n  /**\n   *\n   * Initializes a new state and returns getter and setter for the state\n   * @param {string} state name of the state\n   * @param {any} initialVal initial value\n   * @param {function} watcher watcher function that will be called everytime the value of the state changes\n   *\n   * @returns {Array<[function, function]>} getterFunction and SetterFunction\n   */\n  useState(state, initialVal, watcher) {\n    const stateName = state;\n    let value = initialVal;\n    const setter = (newVal) => {\n      if (watcher) watcher(newVal, value, stateName);\n      value = newVal;\n      this.updateView(stateName, value);\n    };\n    this.updateView(stateName, value, true);\n\n    return [() => value, setter];\n  }\n\n  updateView(stateName, value, firstUpdate) {\n    if (this.view) this.view.update(stateName, value, firstUpdate);\n  }\n}\n\nexport default Comfey;\n","import Comfey, { ComfeyDom } from \"comfey\";\r\n\r\nconst COMFEY_DEBUG = 0;\r\n\r\nconst viewUpdater = new ComfeyDom(document.getElementById(\"ecg\"), COMFEY_DEBUG);\r\nconst ecgApp = new Comfey(viewUpdater);\r\n\r\nconst [_RR, setRR] = ecgApp.useState(\"rr\", 0);\r\nconst [_freq, setFreq] = ecgApp.useState(\"freq\", 0);\r\nconst [_hr, setHR] = ecgApp.useState(\"hr\", 0);\r\nconst [_val, setVal] = ecgApp.useState(\"value\", 0);\r\n\r\nconst pauseBtn = document.getElementById(\"pause-btn\");\r\n\r\nlet t = -1;\r\nconst n = 300;\r\nconst analogResolution = 255;\r\nconst data = [];\r\n\r\nconst margin = {\r\n  top: 6,\r\n  right: 0,\r\n  bottom: 40,\r\n  left: 0,\r\n};\r\nconst width = 600 - margin.right - margin.left;\r\nconst height = 360 - margin.top - margin.bottom;\r\n\r\nconst x = d3.scale\r\n  .linear()\r\n  .domain([t - n + 1, t])\r\n  .range([0, width]);\r\nconst xAxis = d3.svg.axis().scale(x).orient(\"bottom\");\r\n\r\nconst y = d3.scale.linear().range([height, 0]).domain([0, analogResolution]);\r\nconst yAxis = d3.svg.axis().scale(y).orient(\"left\");\r\n\r\nconst line = d3.svg\r\n  .line()\r\n  .interpolate(\"basis\")\r\n  .x(function (d, i) {\r\n    return x(d.time);\r\n  })\r\n  .y(function (d, i) {\r\n    return y(d.value);\r\n  });\r\n\r\nconst svg = d3\r\n  .select(\".ecg-graph\")\r\n  .append(\"p\")\r\n  .append(\"svg\")\r\n  .attr(\"width\", width + margin.left + margin.right)\r\n  .attr(\"height\", height + margin.top + margin.bottom)\r\n  .style(\"margin-left\", margin.left + \"px\")\r\n  .append(\"g\")\r\n  .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\nsvg\r\n  .append(\"defs\")\r\n  .append(\"clipPath\")\r\n  .attr(\"id\", \"clip\")\r\n  .append(\"rect\")\r\n  .attr(\"width\", width)\r\n  .attr(\"height\", height);\r\n\r\nconst $xAxis = svg\r\n  .append(\"g\")\r\n  .attr(\"class\", \"x axis\")\r\n  .attr(\"transform\", \"translate(0,\" + height + \")\")\r\n  .call((x.axis = xAxis));\r\n\r\nconst $yAxis = svg\r\n  .append(\"g\")\r\n  .attr(\"class\", \"y axis\")\r\n  .attr(\"transform\", \"translate(60,0)\")\r\n  .call((y.axis = yAxis));\r\n\r\nconst path = svg\r\n  .append(\"g\")\r\n  .attr(\"clip-path\", \"url(#clip)\")\r\n  .append(\"path\")\r\n  .style(\"fill\", \"none\")\r\n  .style(\"stroke\", \"black\")\r\n  .style(\"stroke-width\", \"1\")\r\n  .data([data])\r\n  .attr(\"class\", \"line\");\r\n\r\nfunction tick() {\r\n  x.domain([t - n + 2, t]);\r\n  $xAxis.call(x.axis);\r\n\r\n  // redraw the line\r\n  svg.select(\".line\").attr(\"d\", line);\r\n\r\n  if (data.length > n) data.shift();\r\n}\r\n\r\nif (\"WebSocket\" in window) {\r\n  const ws = new WebSocket(\"ws://esp-ecg.local/ws\");\r\n  // Mock server\r\n  // var ws = new WebSocket(\"ws://localhost:3211\");\r\n  ws.onerror = (e) => {\r\n    console.error({ e });\r\n  };\r\n  ws.onopen = function () {\r\n    pauseBtn.addEventListener(\"click\", (e) => {\r\n      ws.send(\"p\");\r\n    });\r\n  };\r\n  let millis = 0;\r\n  let millisBuf = [];\r\n  let lastR = +new Date();\r\n  ws.onmessage = function (evt) {\r\n    const val = evt.data;\r\n    val\r\n      .trim()\r\n      .split(\" \")\r\n      .forEach((v) => {\r\n        const newMillis = performance.now();\r\n        const value = parseInt(v);\r\n\r\n        // Calculate the data rate\r\n        if (millisBuf.length <= 100) {\r\n          millisBuf.push(newMillis - millis);\r\n        }\r\n        if (millisBuf.length === 100) {\r\n          const avgMillis = millisBuf.reduce((p, c) => p + c, 0) / 100;\r\n          setFreq(Math.round(1000 / avgMillis));\r\n\r\n          millisBuf = [];\r\n        }\r\n        millis = newMillis;\r\n\r\n        // Calculate heart rate\r\n        if (value > analogResolution * 0.6) {\r\n          const now = +new Date();\r\n          const rr = now - lastR;\r\n          if (rr > 200) {\r\n            lastR = now;\r\n            setRR(rr);\r\n            setHR(Math.round((1000 / rr) * 60));\r\n          }\r\n        }\r\n\r\n        // update Graph\r\n        data.push({\r\n          time: ++t,\r\n          value,\r\n        });\r\n        // document.getElementById(\"data\").append(`, ${value}`);\r\n\r\n        // Just to visualize heart beating\r\n        if (millisBuf.length % 5) setVal(value / 80 + 15);\r\n        tick();\r\n      });\r\n  };\r\n\r\n  ws.onclose = function () {\r\n    console.warn(\"Connection is closed...\");\r\n    setTimeout(() => {\r\n      window.location = \".\";\r\n    }, 2000);\r\n  };\r\n} else {\r\n  console.error(\"WebSocket NOT supported by your Browser!\");\r\n}\r\n\r\ndocument.getElementById(\"new\").addEventListener(\"click\", (e) => {\r\n  const newData = document.createElement(\"textarea\");\r\n  document.getElementById(\"datag\").append(newData);\r\n  document.getElementById(\"data\").setAttribute(\"id\", +new Date());\r\n  newData.setAttribute(\"id\", \"data\");\r\n});\r\n","export default class ComfeyDom {\n  constructor(root = document, debug = false) {\n    this.root = root;\n    this.debug = debug;\n\n    if (debug) {\n      const rootIdentifier =\n        root.tagName + (root.id != '' ? '#' + root.id : '');\n      const debugUI = document.createElement('div');\n      debugUI.addEventListener('dragend', (e) => {\n        e.preventDefault();\n        e.target.style.top = `${e.pageY}px`;\n        e.target.style.left = `${e.pageX}px`;\n      });\n      debugUI.setAttribute('class', 'comfey-debug');\n      debugUI.setAttribute('draggable', true);\n      debugUI.innerHTML = `<h2>Comfey Debug (${rootIdentifier})</h2>\n        <table>\n          <thead>\n            <tr>\n              <th>State</th>\n              <th>Value</th>\n            </tr>\n          </thead>\n          <tbody>\n          </tbody>`;\n      this.root.appendChild(debugUI);\n    }\n  }\n\n  /**\n   * Update DOM, gets triggered by State updates\n   * @param {string} stateName\n   * @param {*} value\n   * @return {void}\n   * @memberof Comfey\n   */\n  update(stateName, value, firstUpdate) {\n    if (firstUpdate) {\n      if (this.debug) {\n        const debugRow = document.createElement('tr');\n        debugRow.innerHTML = `\n              <th>${stateName}</th>\n              <td>\n                <span data-bind=\"${stateName}\"></span>\n              </td>\n            `;\n        this.root.querySelector('.comfey-debug tbody').appendChild(debugRow);\n      }\n    }\n    const boundElems = this.root.querySelectorAll(`[data-bind=\"${stateName}\"]`);\n    for (const boundEl of boundElems) {\n      boundEl.innerHTML = value;\n    }\n\n    // Visible\n    const boundVisibleElems = this.root.querySelectorAll(\n      `[data-bind-visible^=\"${stateName}\"]`\n    );\n\n    for (const boundEl of boundVisibleElems) {\n      const [, val, comparator] = boundEl.dataset.bindVisible.split('::');\n      if (comparator) {\n        console.warn(\n          'Comfey: Comparators are not yet supported in bind-visible.'\n        );\n      }\n      if (val) {\n        if (val === value) {\n          boundEl.classList.add('visible');\n        } else {\n          boundEl.classList.remove('visible');\n        }\n      } else if (value) boundEl.classList.add('visible');\n      else boundEl.classList.remove('visible');\n    }\n\n    // Hidden\n    const boundHiddenElems = this.root.querySelectorAll(\n      `[data-bind-hidden=\"${stateName}\"]`\n    );\n    for (const boundEl of boundHiddenElems) {\n      if (value) boundEl.classList.add('hidden');\n      else boundEl.classList.remove('hidden');\n    }\n\n    // Classes\n    const boundClassElems = this.root.querySelectorAll(\n      `[data-bind-class^=\"${stateName}:\"]`\n    );\n    for (const boundEl of boundClassElems) {\n      const [, val, comparator] = boundEl.dataset.bindClass.split('::');\n      const className = val;\n      if (!className) return;\n\n      if (\n        (value && !comparator) ||\n        (value && comparator && value == comparator)\n      )\n        boundEl.classList.add(className);\n      else boundEl.classList.remove(className);\n    }\n\n    // Attr\n    const boundAttrElems = this.root.querySelectorAll(\n      `[data-bind-attr^=\"${stateName}:\"]`\n    );\n    for (const boundEl of boundAttrElems) {\n      const [, attr, val] = boundEl.dataset.bindAttr.split('::');\n      if (value) boundEl.setAttribute(attr, val.replaceAll('$', value));\n      else boundEl.removeAttribute(attr);\n    }\n  }\n}\n"],"names":["$381c1735c9b1e221$export$2e2bcd8739ae039","constructor","view","debug","this","useState","state","initialVal","watcher","stateName","value","updateView","newVal","firstUpdate","update","$5424bd6f451fcf28$var$ecgApp","root","document","rootIdentifier","tagName","id","debugUI","createElement","addEventListener","e","preventDefault","target","style","top","pageY","left","pageX","setAttribute","innerHTML","appendChild","debugRow","querySelector","boundElems","querySelectorAll","boundEl","boundVisibleElems","val","comparator","dataset","bindVisible","split","console","warn","classList","add","remove","boundHiddenElems","boundClassElems","bindClass","className","boundAttrElems","attr","bindAttr","replaceAll","removeAttribute","getElementById","$5424bd6f451fcf28$var$_RR","$5424bd6f451fcf28$var$setRR","$5424bd6f451fcf28$var$_freq","$5424bd6f451fcf28$var$setFreq","$5424bd6f451fcf28$var$_hr","$5424bd6f451fcf28$var$setHR","$5424bd6f451fcf28$var$_val","$5424bd6f451fcf28$var$setVal","$5424bd6f451fcf28$var$pauseBtn","$5424bd6f451fcf28$var$t","$5424bd6f451fcf28$var$n","$5424bd6f451fcf28$var$data","$5424bd6f451fcf28$var$margin","$5424bd6f451fcf28$var$width","$5424bd6f451fcf28$var$height","$5424bd6f451fcf28$var$x","d3","scale","linear","domain","range","$5424bd6f451fcf28$var$xAxis","svg","axis","orient","$5424bd6f451fcf28$var$y","$5424bd6f451fcf28$var$yAxis","$5424bd6f451fcf28$var$line","line","interpolate","x","d","i","time","y","$5424bd6f451fcf28$var$svg","select","append","$5424bd6f451fcf28$var$$xAxis","call","data","window","ws","WebSocket","onerror","error","onopen","send","millis","millisBuf","lastR","Date","onmessage","evt","trim","forEach","v","newMillis","performance","now","parseInt","length","push","avgMillis","reduce","p","c","Math","round","$5424bd6f451fcf28$var$analogResolution","rr","shift","onclose","setTimeout","location","newData"],"version":3,"file":"index.3f240cef.js.map"}